□ 护眼
由于网页大多是都是白底黑字的,为了护眼,要变换成黑底模式.
那么要怎么变换才是一个最佳方式呢,首先,不考虑习惯,只考虑效果.
在网页上标题一般又黑又浓,正文相对浅且小,这在普通模式是没什么问题,聚焦到黑色并不会刺激眼睛.
有一种办法是反色,如night_mode_pro的filter:invert(1).
但若是Invert反色模式,那么,标题就会又大又白,这样就会有些问题的,因为聚焦到这样的字就会刺激眼睛.
然后再来看习惯问题,普通模式下链接通常为蓝色,或者绿色,但是反向就变成了黄或紫色.
而且,具体到Invert的实现,实测invert滤镜的效果,FireFox下字体就有些改变,在Chrome效果就更差了,几乎是无法阅读的程度.
因此,这里的Dark模式通过计算直接修改元素前景和背景色.
易读性
一段文本,怎样才算容易阅读呢,一般认为,这和背景和前景以及字体有关.
一般来说对比度大就容易阅读,但是,对比度大对眼镜的刺激越大.
同样的背景和前景,字体越大就越容易阅读,字体粗细也有关系,字体太细也不易阅读,太粗也不行,而且粗字体对比度大.
当然还有视错觉的问题,字体相同的情况下,黑底白字就比白底黑字显得更大.
因此,先要找到一个绝对好的解决办法几乎是不可能的.
这里采用了麻烦的办法,在反转中,要保证三个原则.
1.除了黑色,尽可能保持原有的颜色(如原来是深绿,翻转后为浅绿)
2.原来对比度大的还是大,保证原来的对比.
3.将对比度控制在一定范围内,在我的算法里亮度的最大值为109,这里将翻转后字体亮度映射到[70,100]的区间.
这是因为,在白底黑字下,黑无论多么深,都不会有副作用,但翻转后,特别浅颜色就特别刺眼,因此亮度上限为100,但是如果亮度太低,就会看不清了,因此下限为70.
□ 颜色的亮度
虽然有很多模型公式,但是实际测试,它们都有明显的问题.
观察test.htm,同样是255的R,G,B,绿色太刺眼,蓝色几乎看不清,红色差不多刚刚好,那么把RGB对称看待的HS*模型都不适用了,然后再来看亮度公式, L=0.299R+0.587G+0.114B,绿色的贡献要远大于红色,从单色情况看,这种模型好像是对的.但纯绿和白色比较,好像纯绿和白色差不多亮,甚至比白色还亮,但按照这个公式,L绿=150,而L白=255,白色是绿色亮度的1.7倍,从主观上看是不成立.
L**也不行,反正我至少发现了一个明显的反例,Lab.L(255,0,0)≈Lab.L(128,128,128)≈53,

后来我用了一种最大化+抑制的模型.
首先我们认为单色对颜色的贡献比例大致和亮度公式相同.
这种模型认为,在多个色光混合时候,色光的亮度=由参与色光的最大贡献者色亮度.
如何考虑混色和单色呢,对任意R,G,B,取它的Min,它的亮度=它们的共有的那部分值的混色亮度+剔除公共部分的后亮度,对剔除后部分,再重复这一步骤.
不过考虑到某些颜色混合后,不但不会提升,反而会渐弱,如RGB(0,128,0)和RGB(128,128,128),我认为后者比前者还暗一些,因此多色混合会抑制一些亮度,这里我乘上一个系数(程序里是0.92),而且两色混合和三色混合抑制程度不一样,(而且我还发现不同颜色的混合抑制程度也不一样,不过这点在程序里就没体现了,估测这种抑制程度是比较麻烦的),按照这种办法,算出的亮度基本上没有大的问题,当然小的问题肯定是有的.
　　想要从理论上推导出一个亮度公式几乎是不可能的,不同色光其实是不同波长电磁波.然后这些光子打到人视锥细胞上,最后再由大脑经过某种计算,你看到了某种颜色.
　　这个公式其实就是某种经验公式,然后加上某些看似有理的理论,只要基本能工作就可以了.